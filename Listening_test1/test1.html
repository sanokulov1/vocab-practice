<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Listening Test 1</title>
    <style>
        /* General Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            padding-bottom: 80px; /* Space for the fixed progress bar */
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2c3e50;
            position: relative;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* Audio Controls */
        .audio-controls {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }

        .audio-controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            margin: 10px;
        }

        .audio-controls button:hover {
            background-color: #2980b9;
        }

        .audio-player {
            margin-top: 20px;
            width: 100%;
        }

        audio {
            width: 100%;
        }

        /* Parts and Questions */
        .part {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .part-title {
            background-color: #3498db;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .instructions {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-style: italic;
        }

        .question-group {
            margin-bottom: 30px;
        }

        .question {
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .question-number {
            font-weight: bold;
            margin-right: 10px;
            color: #2c3e50;
        }

        /* Multiple Choice Options */
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .option {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            background-color: #f0f8ff;
            border-color: #3498db;
        }

        .option.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* Completion Inputs */
        .completion-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            margin-left: 5px;
        }

        /* Drag and Match */
        .drag-match-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .questions-list-wrapper, .options-list-wrapper {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-height: 200px;
        }

        .questions-list-wrapper h4, .options-list-wrapper h4 {
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .question-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .question-item .question-text {
            flex-grow: 1;
            margin-right: 10px;
        }

        .question-drop-target {
            min-width: 50px;
            background-color: #e0f2f7;
            border: 2px dashed #3498db;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            min-height: 40px;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .question-drop-target.drag-over {
            background-color: #d0eaf0;
            border-color: #2980b9;
        }

        .draggable-option {
            background-color: #e8f4f8;
            border: 1px solid #3498db;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: grab;
            transition: background-color 0.2s, opacity 0.2s;
        }
        
        .draggable-option.dragging, .matched-option.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .draggable-option.hidden {
            display: none;
        }

        .matched-option {
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: grab;
            font-weight: bold;
            display: inline-block;
        }

        /* Highlight feature styles */
        .highlighted-text {
            background-color: springgreen;
        }

        #highlight-popup {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #highlight-popup:hover {
            background-color: #555;
        }

        /* Progress Bar */
        #progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2c3e50;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }
        .progress-number {
            width: 30px;
            height: 30px;
            background-color: #6c757d;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .progress-number.answered {
            background-color: #27ae60;
        }

        /* Submit and Results */
        .submit-section { text-align: center; margin: 30px 0; }
        #submit-btn { background-color: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 18px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        #submit-btn:hover { background-color: #219653; }
        .results-container { display: none; margin-top: 40px; padding: 20px; background-color: #e8f4f8; border-radius: 8px; }
        .results-title { text-align: center; margin-bottom: 20px; color: #2c3e50; }
        #score-display { text-align: center; font-size: 1.5em; font-weight: bold; color: #27ae60; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px dashed #ccc; }
        .results-columns { display: flex; gap: 20px; }
        .results-column { flex: 1; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .results-column h3 { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3498db; color: #2c3e50; }
        .result-item { padding: 10px; border-bottom: 1px solid #eee; }
        .result-question { font-weight: bold; margin-right: 10px; }

        /* Night Mode Styles */
        body.night-mode { background-color: #2c2c2c; color: #e0e0e0; }
        body.night-mode .container { background-color: #3a3a3a; }
        body.night-mode h1, body.night-mode .question-number, body.night-mode .results-title, body.night-mode .results-column h3, body.night-mode #score-display, body.night-mode .questions-list-wrapper h4, body.night-mode .options-list-wrapper h4 { color: #add8e6; }
        body.night-mode header { border-bottom-color: #555; }
        body.night-mode .instructions { background-color: #4a4a4a; }
        body.night-mode .audio-controls { background-color: #555; }
        body.night-mode .part { background-color: #444; border-left-color: #007bff; }
        body.night-mode .part-title { background-color: #007bff; }
        body.night-mode .question { background-color: #4a4a4a; }
        body.night-mode .option { background-color: #4a4a4a; border-color: #666; }
        body.night-mode .option:hover { background-color: #5a5a5a; border-color: #007bff; }
        body.night-mode .option.selected { background-color: #007bff; border-color: #0056b3; }
        body.night-mode .completion-input { background-color: #555; border-color: #777; color: #e0e0e0; }
        body.night-mode .questions-list-wrapper, body.night-mode .options-list-wrapper { background-color: #4a4a4a; border-color: #666; }
        body.night-mode .question-item { background-color: #555; border-color: #666; }
        body.night-mode .question-drop-target { background-color: #333; border-color: #007bff; }
        body.night-mode .draggable-option { background-color: #555; border-color: #007bff; }
        body.night-mode #submit-btn { background-color: #28a745; }
        body.night-mode .results-container { background-color: #4a4a4a; }
        
        #night-mode-toggle { position: absolute; top: 15px; right: 20px; background: none; border: 1px solid #ccc; color: #333; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; }
        body.night-mode #night-mode-toggle { color: #e0e0e0; border-color: #666; }
        body.night-mode #night-mode-toggle .fa-sun { display: none; }
        body.night-mode #night-mode-toggle .fa-moon { display: inline-block; } /* Corrected for night mode */
        body.night-mode #night-mode-toggle .fa-sun { display: none; } /* Corrected for night mode */


        @media (max-width: 768px) {
            .results-columns, .drag-match-container { flex-direction: column; }
            #night-mode-toggle { position: static; margin: 15px auto 0; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>IELTS Listening Test 1</h1>
            <button id="night-mode-toggle" title="Toggle Night Mode">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </button>
        </header>

        <div class="audio-controls">
            <button id="start-btn">Start Test</button>
            <div class="audio-player" id="audio-player" style="display: none;">
                <audio id="audio-source" controls>
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>

        <form id="listening-test">
            <div class="part">
                <div class="part-title">PART 1</div>
                <div class="instructions">
                    <p>Questions 1–10</p>
                    <p>Complete the table below.</p>
                    <p>Write <strong>ONE WORD AND/OR A NUMBER</strong> for each answer.</p>
                </div>
                <div class="question-group">
                    <h3>The London Relocation Services</h3>
                    <div class="question">
                        <h4>Customer's personal details</h4>
                        <p>Customer's name: Anna Woods</p>
                        <p><span class="question-number">1</span> Current address: 118 <input type="text" class="completion-input" name="q1" autocomplete="off" spellcheck="false"></p>
                        <p>Postcode: BT149BJ</p>
                        <p><span class="question-number">2</span> Phone No: <input type="text" class="completion-input" name="q2" autocomplete="off" spellcheck="false"> (Mobile)</p>
                    </div>
                    <div class="question">
                        <h4>Other information</h4>
                        <p><span class="question-number">3</span> Anna is hoping to find work as a <input type="text" class="completion-input" name="q3" autocomplete="off" spellcheck="false"></p>
                        <p><span class="question-number">4</span> She needs to find a <input type="text" class="completion-input" name="q4" autocomplete="off" spellcheck="false"> school for her son.</p>
                    </div>
                    <div class="question">
                        <h4>Requirements for the new property</h4>
                        <p><span class="question-number">5</span> Location: Her preferred location is in the <input type="text" class="completion-input" name="q5" autocomplete="off" spellcheck="false"> of the city.</p>
                        <p><span class="question-number">6</span> Her husband would like to be near a <input type="text" class="completion-input" name="q6" autocomplete="off" spellcheck="false"></p>
                        <p><span class="question-number">7</span> Her son would prefer to be close to a <input type="text" class="completion-input" name="q7" autocomplete="off" spellcheck="false"></p>
                    </div>
                    <div class="question">
                        <h4>Property details</h4>
                        <p><span class="question-number">8</span> She would like to live in a <input type="text" class="completion-input" name="q8" autocomplete="off" spellcheck="false"></p>
                        <p><span class="question-number">9</span> She would prefer <input type="text" class="completion-input" name="q9" autocomplete="off" spellcheck="false"> bedrooms</p>
                        <p><span class="question-number">10</span> A small <input type="text" class="completion-input" name="q10" autocomplete="off" spellcheck="false"> is also desirable</p>
                    </div>
                </div>
            </div>

            <div class="part">
                <div class="part-title">PART 2</div>
                <div class="instructions">
                    <p>Questions 11–14</p>
                    <p>Choose the correct letter, <strong>A</strong>, <strong>B</strong> or <strong>C</strong>.</p>
                </div>
                <div class="question-group">
                    <h3>Canadian Festival Theatre</h3>
                    <div class="question">
                        <p><span class="question-number">11</span> What special offer is there for regular theatre-goers in this season?</p>
                        <div class="options"><div class="option" data-value="A">A They can see a second play at a reduced price.</div><div class="option" data-value="B">B They can buy two tickets and get two free.</div><div class="option" data-value="C">C They can get a discount on Mondays.</div></div>
                        <input type="hidden" name="q11" id="q11_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">12</span> What information is given about the study guides?</p>
                        <div class="options"><div class="option" data-value="A">A They are handed out at the theatre.</div><div class="option" data-value="B">B They provide information on the actors.</div><div class="option" data-value="C">C They give ideas for discussion.</div></div>
                        <input type="hidden" name="q12" id="q12_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">13</span> What information is given about the 'Bring a friend' special?</p>
                        <div class="options"><div class="option" data-value="A">A It is only for those over 65.</div><div class="option" data-value="B">B It applies to a number of productions.</div><div class="option" data-value="C">C It includes a 5% reduction on gifts.</div></div>
                        <input type="hidden" name="q13" id="q13_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">14</span> What does Michael say about the actor Christopher Plunket?</p>
                        <div class="options"><div class="option" data-value="A">A He may retire from acting soon.</div><div class="option" data-value="B">B He writes his own plays.</div><div class="option" data-value="C">C He prefers acting in films to performing live.</div></div>
                        <input type="hidden" name="q14" id="q14_hidden">
                    </div>
                </div>
                <div class="instructions">
                    <p>Questions 15-20</p>
                    <p>What is the main theme of each of the following musicals?</p>
                    <p>Choose SIX answers from the box and write the correct letter, A-H, next to questions 15-20.</p>
                </div>
                <div class="question-group">
                    <div class="drag-match-container" id="drag-match-15-20">
                        <div class="questions-list-wrapper">
                            <h4>Musicals</h4>
                            <div class="question-item"><span class="question-text"><span class="question-number">15</span> The Climb</span><div class="question-drop-target" data-question-id="q15"></div></div>
                            <div class="question-item"><span class="question-text"><span class="question-number">16</span> The Voyagers</span><div class="question-drop-target" data-question-id="q16"></div></div>
                            <div class="question-item"><span class="question-text"><span class="question-number">17</span> Joey Brown</span><div class="question-drop-target" data-question-id="q17"></div></div>
                            <div class="question-item"><span class="question-text"><span class="question-number">18</span> Main Street</span><div class="question-drop-target" data-question-id="q18"></div></div>
                            <div class="question-item"><span class="question-text"><span class="question-number">19</span> Millie and Mike</span><div class="question-drop-target" data-question-id="q19"></div></div>
                            <div class="question-item"><span class="question-text"><span class="question-number">20</span> Windswept</span><div class="question-drop-target" data-question-id="q20"></div></div>
                        </div>
                        <div class="options-list-wrapper">
                            <h4>Main theme</h4>
                            <div class="draggable-option" draggable="true" data-option-id="A">A living in a different century</div>
                            <div class="draggable-option" draggable="true" data-option-id="B">B managing to achieve success</div>
                            <div class="draggable-option" draggable="true" data-option-id="C">C ageing slowly</div>
                            <div class="draggable-option" draggable="true" data-option-id="D">D growing up</div>
                            <div class="draggable-option" draggable="true" data-option-id="E">E experiencing disappointment</div>
                            <div class="draggable-option" draggable="true" data-option-id="F">F living in a magical place</div>
                            <div class="draggable-option" draggable="true" data-option-id="G">G overcoming poverty</div>
                            <div class="draggable-option" draggable="true" data-option-id="H">H handling conflict</div>
                        </div>
                    </div>
                    <input type="hidden" name="q15" id="q15_hidden"><input type="hidden" name="q16" id="q16_hidden">
                    <input type="hidden" name="q17" id="q17_hidden"><input type="hidden" name="q18" id="q18_hidden">
                    <input type="hidden" name="q19" id="q19_hidden"><input type="hidden" name="q20" id="q20_hidden">
                </div>
            </div>

            <div class="part">
                <div class="part-title">PART 3</div>
                <div class="instructions">
                    <p>Questions 21–26</p>
                    <p>Choose the correct letter, <strong>A</strong>, <strong>B</strong> or <strong>C</strong>.</p>
                </div>
                <div class="question-group">
                    <h3>Kathy's dissertation on water pumps</h3>
                    <div class="question"><p><span class="question-number">21</span> What part of Kathy's dissertation has the tutor just read?</p><div class="options"><div class="option" data-value="A">A her results section</div><div class="option" data-value="B">B her introductory chapter</div><div class="option" data-value="C">C her review of the literature</div></div><input type="hidden" name="q21" id="q21_hidden"></div>
                    <div class="question"><p><span class="question-number">22</span> What did the tutor like about Kathy's work?</p><div class="options"><div class="option" data-value="A">A the organisation</div><div class="option" data-value="B">B the style of writing</div><div class="option" data-value="C">C the use of resources</div></div><input type="hidden" name="q22" id="q22_hidden"></div>
                    <div class="question"><p><span class="question-number">23</span> Kathy and the tutor agree that she needs to</p><div class="options"><div class="option" data-value="A">A do some more library research.</div><div class="option" data-value="B">B record more data</div><div class="option" data-value="C">C narrow down her topic.</div></div><input type="hidden" name="q23" id="q23_hidden"></div>
                    <div class="question"><p><span class="question-number">24</span> Why does the tutor give an example from his own experience?</p><div class="options"><div class="option" data-value="A">A to show how successful he has become</div><div class="option" data-value="B">B to illustrate how times have changed</div><div class="option" data-value="C">C to encourage Kathy to do something similar</div></div><input type="hidden" name="q24" id="q24_hidden"></div>
                    <div class="question"><p><span class="question-number">25</span> Kathy would like the tutor to advise her on her</p><div class="options"><div class="option" data-value="A">A layout.</div><div class="option" data-value="B">B bibliography.</div><div class="option" data-value="C">C appendices.</div></div><input type="hidden" name="q25" id="q25_hidden"></div>
                    <div class="question"><p><span class="question-number">26</span> What is Kathy going to do next?</p><div class="options"><div class="option" data-value="A">A try out some software</div><div class="option" data-value="B">B go to a seminar</div><div class="option" data-value="C">C design a new type of pump</div></div><input type="hidden" name="q26" id="q26_hidden"></div>
                </div>
                 <div class="instructions">
                    <p>Questions 27-30</p>
                    <p>How will Kathy benefit from doing each of the following activities?</p>
                    <p>Choose FOUR answers from the box and write the correct letter, A-F, next to questions 27-30.</p>
                </div>
                <div class="question-group">
                     <div class="drag-match-container" id="drag-match-27-30">
                        <div class="questions-list-wrapper">
                            <h4>Activities</h4>
                             <div class="question-item"><span class="question-text"><span class="question-number">27</span> going to Mechanical Engineers' Society meetings</span><div class="question-drop-target" data-question-id="q27"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">28</span> Visiting different workplaces</span><div class="question-drop-target" data-question-id="q28"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">29</span> getting some work experience abroad</span><div class="question-drop-target" data-question-id="q29"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">30</span> attending an international conference</span><div class="question-drop-target" data-question-id="q30"></div></div>
                        </div>
                        <div class="options-list-wrapper">
                            <h4>Benefits</h4>
                            <div class="draggable-option" draggable="true" data-option-id="A">A broadens practical experience of the field</div>
                            <div class="draggable-option" draggable="true" data-option-id="B">B chance to publicise own work</div>
                            <div class="draggable-option" draggable="true" data-option-id="C">C effective way of keeping up-to-date</div>
                            <div class="draggable-option" draggable="true" data-option-id="D">D looks good on a CV</div>
                            <div class="draggable-option" draggable="true" data-option-id="E">E provides useful access to resources</div>
                            <div class="draggable-option" draggable="true" data-option-id="F">F way to make useful contacts</div>
                        </div>
                    </div>
                    <input type="hidden" name="q27" id="q27_hidden"><input type="hidden" name="q28" id="q28_hidden">
                    <input type="hidden" name="q29" id="q29_hidden"><input type="hidden" name="q30" id="q30_hidden">
                </div>
            </div>

            <div class="part">
                <div class="part-title">PART 4</div>
                <div class="instructions">
                    <p>Questions 31–40</p>
                    <p>Complete the notes below.</p>
                    <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                </div>
                <div class="question-group">
                    <h3>Risk assessment</h3>
                    <h4>Food Safety Standards</h4>
                    <div class="question">
                        <p>Scientists have to consider potential problems with:</p>
                        <p><span class="question-number">31</span> the product's <input type="text" class="completion-input" name="q31" autocomplete="off" spellcheck="false"></p>
                        <p>method of preparation (will it eliminate harmful micro-organisms?)</p>
                        <p><span class="question-number">32</span> how products are <input type="text" class="completion-input" name="q32" autocomplete="off" spellcheck="false"> and distributed</p>
                        <p><span class="question-number">33</span> supermarkets (e.g. changes in <input type="text" class="completion-input" name="q33" autocomplete="off" spellcheck="false"></p>
                        <p>end-users (how is food usually handled in the home?)</p>
                    </div>
                    <h4>Factors affecting food consumption</h4>
                    <div class="question">
                        <p><strong>Legislation</strong></p>
                        <p><strong>Consumer attitudes</strong></p>
                        <p><span class="question-number">34</span> e.g. dislike of additives → growth of the <input type="text" class="completion-input" name="q34" autocomplete="off" spellcheck="false"> food market in Australia</p>
                        <p><strong>The food industry</strong></p>
                        <p><span class="question-number">35</span> supermarkets may use price or <input type="text" class="completion-input" name="q35" autocomplete="off" spellcheck="false"> as their selling strategy (but the main concern is profitability)</p>
                        <p><strong>The mass media</strong></p>
                        <p><span class="question-number">36</span> now the main source of <input type="text" class="completion-input" name="q36" autocomplete="off" spellcheck="false"> for many</p>
                        <p>negative effect because not objective:</p>
                        <p><span class="question-number">37</span> concern for <input type="text" class="completion-input" name="q37" autocomplete="off" spellcheck="false"></p>
                        <p><span class="question-number">38</span> news is now a form of <input type="text" class="completion-input" name="q38" autocomplete="off" spellcheck="false"></p>
                        <p><span class="question-number">39</span> few programmes deal with food safety or <input type="text" class="completion-input" name="q39" autocomplete="off" spellcheck="false"></p>
                        <p><strong>Personal opinion</strong> which can mislead the public</p>
                    </div>
                    <div class="question">
                        <p><strong>Importance of education:</strong> <span class="question-number">40</span> as with benefits of exercise, many children can influence their <input type="text" class="completion-input" name="q40" autocomplete="off" spellcheck="false"></p>
                    </div>
                </div>
            </div>

            <div class="submit-section">
                <button type="button" id="submit-btn">Submit Answers</button>
            </div>
        </form>

        <div class="results-container" id="results-container">
            <h2 class="results-title">Your Answers</h2>
            <div id="score-display"></div>
            <div class="results-columns">
                <div class="results-column">
                    <h3>Questions 1-20</h3>
                    <div id="results-1-20"></div>
                </div>
                <div class="results-column">
                    <h3>Questions 21-40</h3>
                    <div id="results-21-40"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="highlight-popup">Highlight</div>
    <div id="progress-bar"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('listening-test');
            
            // --- Audio Playback ---
            const startBtn = document.getElementById('start-btn');
            const audioPlayerDiv = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            
            const audioFiles = [
                'test1_p1.mp3',
                'test1_p2.mp3',
                'test1_p3.mp3',
                'test1_p4.mp3'
            ];
            let currentAudioIndex = 0;

            function playNextAudio() {
                if (currentAudioIndex < audioFiles.length) {
                    audioSource.src = audioFiles[currentAudioIndex]; // Set the source first
                    audioSource.play();
                    currentAudioIndex++;
                } else {
                    // All audio files have been played
                    startBtn.textContent = 'Test Completed';
                    startBtn.disabled = true;
                }
            }

            startBtn.addEventListener('click', function() {
                audioPlayerDiv.style.display = 'block';
                startBtn.textContent = 'Playing...';
                startBtn.disabled = true;
                playNextAudio(); // Start playing the first audio
            });

            audioSource.addEventListener('ended', function() {
                playNextAudio(); // Play the next audio when the current one ends
            });

            // --- Multiple Choice Selection ---
            form.querySelectorAll('.options .option').forEach(option => {
                option.addEventListener('click', function() {
                    const siblings = this.parentElement.querySelectorAll('.option');
                    siblings.forEach(sib => sib.classList.remove('selected'));
                    this.classList.add('selected');
                    const questionInput = this.closest('.question').querySelector('input[type="hidden"]');
                    questionInput.value = this.dataset.value;
                    updateProgressBar();
                });
            });

            // --- Night Mode Toggle ---
            const nightModeToggle = document.getElementById('night-mode-toggle');
            const body = document.body;
            const isNightMode = localStorage.getItem('nightMode') === 'enabled';
            if (isNightMode) { body.classList.add('night-mode'); }
            nightModeToggle.addEventListener('click', () => {
                body.classList.toggle('night-mode');
                localStorage.setItem('nightMode', body.classList.contains('night-mode') ? 'enabled' : 'disabled');
            });

            // --- Drag and Drop Logic ---
            function setupDragDrop(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                let draggedItem = null;

                container.addEventListener('dragstart', e => {
                    if (e.target.classList.contains('draggable-option') || e.target.classList.contains('matched-option')) {
                        draggedItem = e.target;
                        setTimeout(() => e.target.style.display = 'none', 0);
                        e.dataTransfer.setData('text/plain', e.target.dataset.optionId);
                    }
                });

                container.addEventListener('dragend', () => {
                    if (draggedItem) {
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                    }
                });
                
                container.addEventListener('dragover', e => e.preventDefault());

                container.querySelectorAll('.question-drop-target, .options-list-wrapper').forEach(zone => {
                    zone.addEventListener('dragenter', e => {
                        e.preventDefault();
                        if (zone.classList.contains('question-drop-target') || zone.classList.contains('options-list-wrapper')) {
                           zone.classList.add('drag-over');
                        }
                    });
                    zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        if (!draggedItem) return;

                        const optionId = draggedItem.dataset.optionId;
                        const originalOption = container.querySelector(`.draggable-option[data-option-id="${optionId}"]`);
                        const sourceQuestionId = draggedItem.parentElement.dataset.questionId;

                        // If dropping back into the options list
                        if (zone.classList.contains('options-list-wrapper')) {
                            if (originalOption) originalOption.classList.remove('hidden');
                            if(draggedItem.classList.contains('matched-option')) {
                                document.getElementById(`${sourceQuestionId}_hidden`).value = '';
                                draggedItem.remove();
                            }
                        } 
                        // If dropping into a question target
                        else if (zone.classList.contains('question-drop-target')) {
                            // If target has an item, return it
                            if (zone.children.length > 0) {
                                const oldOptionId = zone.children[0].dataset.optionId;
                                const oldOriginalOption = container.querySelector(`.draggable-option[data-option-id="${oldOptionId}"]`);
                                if (oldOriginalOption) oldOriginalOption.classList.remove('hidden');
                            }
                            
                            // Add new item
                            if (originalOption) originalOption.classList.add('hidden');
                             if(draggedItem.classList.contains('matched-option')) {
                                document.getElementById(`${sourceQuestionId}_hidden`).value = '';
                            }
                            
                            const newMatchedOption = document.createElement('div');
                            newMatchedOption.className = 'matched-option';
                            newMatchedOption.draggable = true;
                            newMatchedOption.dataset.optionId = optionId;
                            newMatchedOption.textContent = optionId;
                            zone.innerHTML = '';
                            zone.appendChild(newMatchedOption);
                            document.getElementById(`${zone.dataset.questionId}_hidden`).value = optionId;
                        }
                        
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                        updateProgressBar();
                    });
                });
            }

            setupDragDrop('drag-match-15-20');
            setupDragDrop('drag-match-27-30');

            // --- Highlight Feature ---
            const highlightPopup = document.getElementById('highlight-popup');
            let currentSelection = null;

            document.addEventListener('mouseup', function(e) {
                if (e.target.id === 'highlight-popup' || e.target.closest('input, .audio-controls, #progress-bar')) {
                    return;
                }
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0) {
                    currentSelection = selection.getRangeAt(0);
                    const rect = currentSelection.getBoundingClientRect();
                    highlightPopup.style.display = 'block';
                    highlightPopup.style.left = `${rect.left + window.scrollX}px`;
                    highlightPopup.style.top = `${rect.top + window.scrollY - 35}px`;
                } else {
                    highlightPopup.style.display = 'none';
                }
            });
            
            document.addEventListener('mousedown', function(e) {
                 if (e.target.id !== 'highlight-popup' && highlightPopup.style.display === 'block') {
                    highlightPopup.style.display = 'none';
                 }
            });

            highlightPopup.addEventListener('click', function() {
                if (currentSelection) {
                    const span = document.createElement('span');
                    span.className = 'highlighted-text';
                    try {
                        span.appendChild(currentSelection.extractContents());
                        currentSelection.insertNode(span);
                    } catch (ex) {
                        console.warn("Could not highlight selection:", ex);
                    }
                }
                highlightPopup.style.display = 'none';
                window.getSelection().removeAllRanges();
            });

            // --- Progress Bar ---
            const progressBar = document.getElementById('progress-bar');
            for (let i = 1; i <= 40; i++) {
                const numDiv = document.createElement('div');
                numDiv.className = 'progress-number';
                numDiv.id = `progress-${i}`;
                numDiv.textContent = i;
                progressBar.appendChild(numDiv);
            }

            function updateProgressBar() {
                for (let i = 1; i <= 40; i++) {
                    const input = form.querySelector(`[name="q${i}"]`);
                    const progressNum = document.getElementById(`progress-${i}`);
                    if (input && input.value.trim() !== '') {
                        progressNum.classList.add('answered');
                    } else {
                        progressNum.classList.remove('answered');
                    }
                }
            }
            form.addEventListener('input', updateProgressBar);
            form.addEventListener('click', (e) => {
                if(e.target.classList.contains('option')) {
                    setTimeout(updateProgressBar, 50);
                }
            });
            updateProgressBar();

            // --- Correct Answers & Submission ---
            const correctAnswers = {
                q1: "fordyce", q2: "07840051963", q3: "nurse", q4: "primary", q5: "south",
                q6: "station", q7: "park", q8: "house", q9: ["three", "3"], q10: "office",
                q11: "a", q12: "c", q13: "b", q14: "a", q15: "b",
                q16: "a", q17: "h", q18: "e", q19: "d", q20: "f",
                q21: "b", q22: "a", q23: "b", q24: "c", q25: "c", q26: "a",
                q27: "f", q28: "c", q29: "a", q30: "b",
                q31: "ingredients", q32: "stored", q33: "temperature", q34: "organic", q35: "image",
                q36: "information", q37: "sales", q38: "entertainment", q39: "nutrition", q40: "parents"
            };

            document.getElementById('submit-btn').addEventListener('click', function() {
                const userAnswers = {};
                let correctCount = 0;

                for (let i = 1; i <= 40; i++) {
                    const qName = `q${i}`;
                    const input = form.querySelector(`[name="${qName}"]`);
                    if (input) {
                        userAnswers[qName] = input.value.trim().toLowerCase();
                    }
                }

                for (const qName in correctAnswers) {
                    if (!userAnswers.hasOwnProperty(qName)) continue;

                    const correctAnswer = correctAnswers[qName];
                    const userAnswer = userAnswers[qName];

                    if (Array.isArray(correctAnswer)) {
                        if (correctAnswer.includes(userAnswer)) {
                            correctCount++;
                        }
                    } else {
                        if (userAnswer === correctAnswer) {
                            correctCount++;
                        }
                    }
                }
                
                let results1to20 = '';
                let results21to40 = '';

                for (let i = 1; i <= 40; i++) {
                    const qName = `q${i}`;
                    let userAns = userAnswers[qName] || 'No answer';
                    let correctAns = Array.isArray(correctAnswers[qName]) ? correctAnswers[qName].join(' / ') : correctAnswers[qName];
                    const resultItem = `<div class="result-item">
                        <span class="result-question">${i}.</span> User: ${userAns} | Correct: ${correctAns}
                    </div>`;
                    if (i <= 20) {
                        results1to20 += resultItem;
                    } else {
                        results21to40 += resultItem;
                    }
                }

                document.getElementById('results-1-20').innerHTML = results1to20;
                document.getElementById('results-21-40').innerHTML = results21to40;
                document.getElementById('score-display').textContent = `You got ${correctCount} out of 40 correct!`;
                document.getElementById('results-container').style.display = 'block';
                document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>