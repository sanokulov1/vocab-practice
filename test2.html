<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Listening Test 2</title>
    <style>
        /* General Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            padding-bottom: 80px; /* Space for the fixed progress bar */
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2c3e50;
            position: relative;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* Audio Controls */
        .audio-controls {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }

        .audio-controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            margin: 10px;
        }

        .audio-controls button:hover {
            background-color: #2980b9;
        }

        .audio-player {
            margin-top: 20px;
            width: 100%;
        }

        audio {
            width: 100%;
        }

        /* Parts and Questions */
        .part {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .part-title {
            background-color: #3498db;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .instructions {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-style: italic;
        }

        .question-group {
            margin-bottom: 30px;
        }

        .question {
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .question-number {
            font-weight: bold;
            margin-right: 10px;
            color: #2c3e50;
        }

        /* Multiple Choice Options */
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .option {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            background-color: #f0f8ff;
            border-color: #3498db;
        }

        .option.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* Completion Inputs */
        .completion-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            margin-left: 5px;
        }

        /* Drag and Match */
        .drag-match-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .questions-list-wrapper, .options-list-wrapper {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-height: 200px;
        }

        .questions-list-wrapper h4, .options-list-wrapper h4 {
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .question-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .question-item .question-text {
            flex-grow: 1;
            margin-right: 10px;
        }

        .question-drop-target {
            min-width: 50px;
            background-color: #e0f2f7;
            border: 2px dashed #3498db;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            min-height: 40px;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .question-drop-target.drag-over {
            background-color: #d0eaf0;
            border-color: #2980b9;
        }

        .draggable-option {
            background-color: #e8f4f8;
            border: 1px solid #3498db;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: grab;
            transition: background-color 0.2s, opacity 0.2s;
        }
        
        .draggable-option.dragging, .matched-option.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .draggable-option.hidden {
            display: none;
        }

        .matched-option {
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: grab;
            font-weight: bold;
            display: inline-block;
        }

        /* Highlight feature styles */
        .highlighted-text {
            background-color: springgreen;
        }

        #highlight-popup {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #highlight-popup:hover {
            background-color: #555;
        }

        /* Progress Bar */
        #progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2c3e50;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }
        .progress-number {
            width: 30px;
            height: 30px;
            background-color: #6c757d;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .progress-number.answered {
            background-color: #27ae60;
        }

        /* Submit and Results */
        .submit-section { text-align: center; margin: 30px 0; }
        #submit-btn { background-color: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 18px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        #submit-btn:hover { background-color: #219653; }
        .results-container { display: none; margin-top: 40px; padding: 20px; background-color: #e8f4f8; border-radius: 8px; }
        .results-title { text-align: center; margin-bottom: 20px; color: #2c3e50; }
        #score-display { text-align: center; font-size: 1.5em; font-weight: bold; color: #27ae60; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px dashed #ccc; }
        .results-columns { display: flex; gap: 20px; }
        .results-column { flex: 1; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .results-column h3 { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3498db; color: #2c3e50; }
        .result-item { padding: 10px; border-bottom: 1px solid #eee; }
        .result-question { font-weight: bold; margin-right: 10px; }

        /* Night Mode Styles */
        body.night-mode { background-color: #2c2c2c; color: #e0e0e0; }
        body.night-mode .container { background-color: #3a3a3a; }
        body.night-mode h1, body.night-mode .question-number, body.night-mode .results-title, body.night-mode .results-column h3, body.night-mode .score-display, body.night-mode .questions-list-wrapper h4, body.night-mode .options-list-wrapper h4 { color: #add8e6; }
        body.night-mode header { border-bottom-color: #555; }
        body.night-mode .instructions { background-color: #4a4a4a; }
        body.night-mode .audio-controls { background-color: #555; }
        body.night-mode .part { background-color: #444; border-left-color: #007bff; }
        body.night-mode .part-title { background-color: #007bff; }
        body.night-mode .question { background-color: #4a4a4a; }
        body.night-mode .option { background-color: #4a4a4a; border-color: #666; }
        body.night-mode .option:hover { background-color: #5a5a5a; border-color: #007bff; }
        body.night-mode .option.selected { background-color: #007bff; border-color: #0056b3; }
        body.night-mode .completion-input { background-color: #555; border-color: #777; color: #e0e0e0; }
        body.night-mode .questions-list-wrapper, body.night-mode .options-list-wrapper { background-color: #4a4a4a; border-color: #666; }
        body.night-mode .question-item { background-color: #555; border-color: #666; }
        body.night-mode .question-drop-target { background-color: #333; border-color: #007bff; }
        body.night-mode .draggable-option { background-color: #555; border-color: #007bff; }
        body.night-mode #submit-btn { background-color: #28a745; }
        body.night-mode .results-container { background-color: #4a4a4a; }
        
        #night-mode-toggle { position: absolute; top: 15px; right: 20px; background: none; border: 1px solid #ccc; color: #333; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; }
        body.night-mode #night-mode-toggle { color: #e0e0e0; border-color: #666; }
        #night-mode-toggle .fa-sun { display: none; }
        body.night-mode #night-mode-toggle .fa-sun { display: inline-block; }
        body.night-mode #night-mode-toggle .fa-moon { display: none; }


        @media (max-width: 768px) {
            .results-columns, .drag-match-container { flex-direction: column; }
            #night-mode-toggle { position: static; margin: 15px auto 0; }
        }

        /* Specific styles for the Recycling Tyres diagram */
        .recycling-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .diagram-row {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            gap: 20px;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .diagram-box {
            border: 1px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            background-color: #e8f4f8;
            min-width: 250px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .diagram-box.process-box {
            background-color: #d0eaf0;
            border-color: #2980b9;
        }

        .diagram-box.uses-box {
            background-color: #f0f8ff;
            border-color: #3498db;
        }

        .diagram-arrow {
            font-size: 2em;
            color: #3498db;
            margin: 0 10px;
        }

        .diagram-connector {
            width: 2px;
            height: 20px;
            background-color: #3498db;
        }

        .diagram-vertical-arrow {
            font-size: 2em;
            color: #3498db;
            margin: 5px 0;
            transform: rotate(90deg);
        }

        .diagram-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .diagram-list {
            text-align: left;
            width: 100%;
            list-style: none; /* Remove default bullet points */
            padding-left: 0;
        }

        .diagram-list li {
            margin-bottom: 5px;
        }

        .diagram-list li:before {
            content: '• '; /* Custom bullet point */
            color: #3498db;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        body.night-mode .recycling-diagram {
            background-color: #4a4a4a;
            border-color: #666;
        }
        body.night-mode .diagram-box {
            background-color: #555;
            border-color: #007bff;
        }
        body.night-mode .diagram-box.process-box {
            background-color: #444;
            border-color: #0056b3;
        }
        body.night-mode .diagram-box.uses-box {
            background-color: #5a5a5a;
            border-color: #007bff;
        }
        body.night-mode .diagram-arrow, body.night-mode .diagram-vertical-arrow, body.night-mode .diagram-connector, body.night-mode .diagram-list li:before {
            color: #add8e6;
        }
        body.night-mode .diagram-label {
            color: #add8e6;
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>IELTS Listening Test 2</h1>
            <button id="night-mode-toggle" title="Toggle Night Mode">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </button>
        </header>

        <div class="audio-controls">
            <button id="start-btn">Start Test</button>
            <div class="audio-player" id="audio-player" style="display: none;">
                <audio id="audio-source" controls>
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>

        <form id="listening-test">
            <!-- PART 1 -->
            <div class="part">
                <div class="part-title">PART 1</div>
                <div class="instructions">
                    <p>Questions 1–10</p>
                    <p>Complete the notes below.</p>
                    <p>Write <strong>ONE WORD AND/OR A NUMBER</strong> for each answer.</p>
                </div>
                <div class="question-group">
                    <h3>Campsites</h3>
                    <div class="question">
                        <h4>Westerly Campsite</h4>
                        <p>Campsite for families with children under 12</p>
                        <p>Location: near the <span class="question-number">1</span> <input type="text" class="completion-input" name="q1"></p>
                        <p>Special attraction for children: the <span class="question-number">2</span> <input type="text" class="completion-input" name="q2"></p>
                        <p>A local farmer sells <span class="question-number">3</span> <input type="text" class="completion-input" name="q3"> allowed</p>
                        <p>Campers are allowed to have a <span class="question-number">4</span> <input type="text" class="completion-input" name="q4"></p>
                        <p>Cost per night <span class="question-number">5</span> £ <input type="text" class="completion-input" name="q5"></p>
                    </div>
                    <div class="question">
                        <h4>Snetton Forest Campsite</h4>
                        <p>Cost per night: £ 5 per adult (children free)</p>
                        <p>Recommended for people who like <span class="question-number">6</span> <input type="text" class="completion-input" name="q6"></p>
                        <p>Campers can hire a <span class="question-number">7</span> <input type="text" class="completion-input" name="q7"></p>
                        <p>Activity organised for children: <span class="question-number">8</span> <input type="text" class="completion-input" name="q8"></p>
                    </div>
                    <div class="question">
                        <h4>Trenty Valley Campsite</h4>
                        <p>Better month for families to go: <span class="question-number">9</span> <input type="text" class="completion-input" name="q9"></p>
                        <p>Has an outdoor <span class="question-number">10</span> <input type="text" class="completion-input" name="q10"></p>
                    </div>
                </div>
            </div>

            <!-- PART 2 -->
            <div class="part">
                <div class="part-title">PART 2</div>
                <div class="instructions">
                    <p>Questions 11–16</p>
                    <p>Choose the correct letter, <strong>A</strong>, <strong>B</strong> or <strong>C</strong>.</p>
                </div>
                <div class="question-group">
                    <div class="question">
                        <p><span class="question-number">11</span> What is the most important attitude towards making mistakes according to Arthur?</p>
                        <div class="options"><div class="option" data-value="A">A "Mistakes are inevitable."</div><div class="option" data-value="B">B "Mistakes can be a chance to learn"</div><div class="option" data-value="C">C "Mistakes can cause serious consequences."</div></div>
                        <input type="hidden" name="q11" id="q11_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">12</span> What's true about self-confidence according to Arthur?</p>
                        <div class="options"><div class="option" data-value="A">A self-confidence sometimes leads to failure</div><div class="option" data-value="B">B It means being ambitious with what you do</div><div class="option" data-value="C">C Self-confidence can be gained through reading</div></div>
                        <input type="hidden" name="q12" id="q12_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">13</span> What advice does Arthur give to new business leaders?</p>
                        <div class="options"><div class="option" data-value="A">A "Read business journals"</div><div class="option" data-value="B">B "try new things"</div><div class="option" data-value="C">C "Keep their aims"</div></div>
                        <input type="hidden" name="q13" id="q13_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">14</span> How does Arthur deal with difficult problems?</p>
                        <div class="options"><div class="option" data-value="A">A Ask for advice from friends</div><div class="option" data-value="B">B Seek help from experts</div><div class="option" data-value="C">C Try to get advice from books</div></div>
                        <input type="hidden" name="q14" id="q14_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">15</span> What's the common quality of leaders?</p>
                        <div class="options"><div class="option" data-value="A">A "Have good public speaking skills"</div><div class="option" data-value="B">B "Solve all problems skillfully"</div><div class="option" data-value="C">C "be respected by the workforce"</div></div>
                        <input type="hidden" name="q15" id="q15_hidden">
                    </div>
                    <div class="question">
                        <p><span class="question-number">16</span> How should companies take risks?</p>
                        <div class="options"><div class="option" data-value="A">A "deal with them carefully"</div><div class="option" data-value="B">B "be financially advantageous"</div><div class="option" data-value="C">C "think in the long run"</div></div>
                        <input type="hidden" name="q16" id="q16_hidden">
                    </div>
                </div>
                <div class="instructions">
                    <p>Questions 17-18</p>
                    <p>Choose TWO letters, <strong>A-E</strong>.</p>
                    <p>Which TWO factors are important when starting a business?</p>
                </div>
                 <div class="question-group multi-select-two-group" id="q17_18_group">
                    <div class="options">
                        <div class="option" data-value="A">A fix realistic prices</div>
                        <div class="option" data-value="B">B create products better than the competitors'</div>
                        <div class="option" data-value="C">C be committed</div>
                        <div class="option" data-value="D">D pay attention to detail</div>
                        <div class="option" data-value="E">E apply complete strategy</div>
                    </div>
                    <input type="hidden" name="q17_18_selected" id="q17_18_selected_hidden">
                 </div>
                <div class="instructions">
                    <p>Questions 19-20</p>
                    <p>Choose TWO letters, <strong>A-E</strong>.</p>
                    <p>Which TWO kinds of support are important for Arthur?</p>
                </div>
                <div class="question-group multi-select-two-group" id="q19_20_group">
                    <div class="options">
                        <div class="option" data-value="A">A family supportS</div>
                        <div class="option" data-value="B">B good business advice with new ideas</div>
                        <div class="option" data-value="C">C support of the bank loan</div>
                        <div class="option" data-value="D">D friends' support</div>
                        <div class="option" data-value="E">E governmental funding</div>
                    </div>
                    <input type="hidden" name="q19_20_selected" id="q19_20_selected_hidden">
                </div>
            </div>

            <!-- PART 3 -->
            <div class="part">
                <div class="part-title">PART 3</div>
                <div class="instructions">
                    <p>Questions 21–24</p>
                    <p>Choose the correct letter, <strong>A</strong>, <strong>B</strong> or <strong>C</strong>.</p>
                </div>
                <div class="question-group">
                    <h3>Dolphin presentation</h3>
                    <div class="question"><p><span class="question-number">21</span> What is the students' purpose in mentioning the way dolphins make sounds?</p><div class="options"><div class="option" data-value="A">A to show comparison with human speech</div><div class="option" data-value="B">B to show the unusual anatomy of a dolphin's head</div><div class="option" data-value="C">C to show recent developments in understanding the meaning of the sounds</div></div><input type="hidden" name="q21" id="q21_hidden"></div>
                    <div class="question"><p><span class="question-number">22</span> According to Fran, Hector's dolphins are unaffected by</p><div class="options"><div class="option" data-value="A">A tourist numbers.</div><div class="option" data-value="B">B the threat from fishing nets.</div><div class="option" data-value="C">C their slow breeding rate.</div></div><input type="hidden" name="q22" id="q22_hidden"></div>
                    <div class="question"><p><span class="question-number">23</span> The New Zealand Government set up a marine sanctuary</p><div class="options"><div class="option" data-value="A">A because of public pressure.</div><div class="option" data-value="B">B as a result of scientific research.</div><div class="option" data-value="C">C to protect a dolphin feeding ground.</div></div><input type="hidden" name="q23" id="q23_hidden"></div>
                    <div class="question"><p><span class="question-number">24</span> Where is the largest population of Hector's dolphins in New Zealand?</p><div class="options"><div class="option" data-value="A">A the east coast</div><div class="option" data-value="B">B Southland</div><div class="option" data-value="C">C the west coast</div></div><input type="hidden" name="q24" id="q24_hidden"></div>
                </div>
                 <div class="instructions">
                    <p>Questions 25-30</p>
                    <p>Which special characteristic does each of the following types of dolphin have?</p>
                    <p>Write the correct letter, <strong>A-H</strong>.</p>
                </div>
                <div class="question-group">
                     <div class="drag-match-container" id="drag-match-25-30">
                        <div class="questions-list-wrapper">
                            <h4>Types of dolphin</h4>
                             <div class="question-item"><span class="question-text"><span class="question-number">25</span> Common dolphins</span><div class="question-drop-target" data-question-id="q25"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">26</span> Dusky dolphins</span><div class="question-drop-target" data-question-id="q26"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">27</span> Hector's dolphins</span><div class="question-drop-target" data-question-id="q27"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">28</span> Maui's dolphins</span><div class="question-drop-target" data-question-id="q28"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">29</span> Orcas</span><div class="question-drop-target" data-question-id="q29"></div></div>
                             <div class="question-item"><span class="question-text"><span class="question-number">30</span> Bottle-nose dolphins</span><div class="question-drop-target" data-question-id="q30"></div></div>
                        </div>
                        <div class="options-list-wrapper">
                            <h4>Special characteristics</h4>
                            <div class="draggable-option" draggable="true" data-option-id="A">A swim along behind boats</div>
                            <div class="draggable-option" draggable="true" data-option-id="B">B swim in unusually large groups</div>
                            <div class="draggable-option" draggable="true" data-option-id="C">C live along New Zealand's entire coastline</div>
                            <div class="draggable-option" draggable="true" data-option-id="D">D swim beneath slow-moving boats</div>
                            <div class="draggable-option" draggable="true" data-option-id="E">E tend to be solitary</div>
                            <div class="draggable-option" draggable="true" data-option-id="F">F live only off New Zealand's northwest coast</div>
                            <div class="draggable-option" draggable="true" data-option-id="G">G are the second largest dolphin species in New Zealand</div>
                            <div class="draggable-option" draggable="true" data-option-id="H">H are seen mostly in Kaikoura</div>
                        </div>
                    </div>
                    <input type="hidden" name="q25" id="q25_hidden"><input type="hidden" name="q26" id="q26_hidden">
                    <input type="hidden" name="q27" id="q27_hidden"><input type="hidden" name="q28" id="q28_hidden">
                    <input type="hidden" name="q29" id="q29_hidden"><input type="hidden" name="q30" id="q30_hidden">
                </div>
            </div>

            <!-- PART 4 -->
            <div class="part">
                <div class="part-title">PART 4</div>
                <div class="instructions">
                    <p>Questions 31–34</p>
                    <p>Complete the notes below.</p>
                    <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                </div>
                <div class="question-group">
                    <h3>Recycling Tyres in Australia</h3>
                    <h4>Background</h4>
                    <div class="question">
                        <p>More than 1.5 million tyres dumped in Australia per <span class="question-number">31</span> <input type="text" class="completion-input" name="q31"></p>
                        <p>Previous recycling attempts because:</p>
                        <p>there were pollution problems - smoke from burning</p>
                        <p>recycling companies didn't make any <span class="question-number">32</span> <input type="text" class="completion-input" name="q32"></p>
                    </div>
                    <h4>Advantages of Molectra's process</h4>
                    <div class="question">
                        <p>More economical because smaller machines are used</p>
                        <p>Less maintenance - tyres softened before shredding</p>
                        <p>No limit on the <span class="question-number">33</span> <input type="text" class="completion-input" name="q33"> of tyres recycled</p>
                    </div>
                    <h4>The Future</h4>
                    <div class="question">
                        <p>Ten more factories being built</p>
                        <p>Plans to spend 5% of income each year on <span class="question-number">34</span> <input type="text" class="completion-input" name="q34"></p>
                    </div>
                </div>

                <div class="instructions">
                    <p>Questions 35-40</p>
                    <p>Complete the below.</p>
                    <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                </div>
                <div class="question-group">
                    <h3>RECYCLING TYRES</h3>
                    <!-- Diagram for Recycling Tyres (Questions 35-40) -->
                    <div class="recycling-diagram">
                        <!-- Diagram Row 1: Q35 Process -> Uses -->
                        <div class="diagram-row">
                            <div class="diagram-box process-box">
                                <div class="diagram-label">Process</div>
                                <p>Removal of steel <span class="question-number">35</span> <input type="text" class="completion-input" name="q35"></p>
                                <p>from tyre rim</p>
                            </div>
                            <div class="diagram-arrow">&#10140;</div> <!-- Right arrow -->
                            <div class="diagram-box uses-box">
                                <div class="diagram-label">Possible Uses</div>
                                <p>Steel pellets used in industry</p>
                            </div>
                        </div>

                        <!-- Vertical flow connector from Q35 Process -->
                        <div class="diagram-connector"></div>
                        <div class="diagram-vertical-arrow">&#10140;</div> <!-- Down arrow -->
                        <div class="diagram-connector"></div>

                        <!-- Diagram Row for Q36 (alone) -->
                        <div class="diagram-row">
                            <div class="diagram-box process-box">
                                <p>Chemicals applied to get rid of</p>
                                <p><span class="question-number">36</span> <input type="text" class="completion-input" name="q36"> and soften rubber</p>
                            </div>
                            <!-- No horizontal arrow or uses box here as per new instruction -->
                        </div>

                        <!-- Vertical flow connector from Q36 Process -->
                        <div class="diagram-connector"></div>
                        <div class="diagram-vertical-arrow">&#10140;</div> <!-- Down arrow -->
                        <div class="diagram-connector"></div>

                        <!-- Diagram Row for Fibres and Q37 Uses -->
                        <div class="diagram-row">
                            <div class="diagram-box process-box">
                                <p>Fibres, e.g. nylon, removed</p>
                            </div>
                            <div class="diagram-arrow">&#10140;</div> <!-- Right arrow -->
                            <div class="diagram-box uses-box">
                                <ul class="diagram-list">
                                    <li>Strengthening concrete</li>
                                    <li>Sheets made of <span class="question-number">37</span> <input type="text" class="completion-input" name="q37"></li>
                                </ul>
                            </div>
                        </div>

                        <!-- Vertical flow connector from Tyres cut up Process -->
                        <div class="diagram-connector"></div>
                        <div class="diagram-vertical-arrow">&#10140;</div> <!-- Down arrow -->
                        <div class="diagram-connector"></div>

                        <!-- Diagram Row for Tyres cut up and Q38 Uses -->
                        <div class="diagram-row">
                            <div class="diagram-box process-box">
                                <p>Tyres cut up into crumb rubber</p>
                            </div>
                            <div class="diagram-arrow">&#10140;</div> <!-- Right arrow -->
                            <div class="diagram-box uses-box">
                                <ul class="diagram-list">
                                    <li>Asphalt for roads</li>
                                    <li>Insulation</li>
                                    <li><span class="question-number">38</span> <input type="text" class="completion-input" name="q38"> tiles</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Vertical flow connector from Tyres cut up Process -->
                        <div class="diagram-connector"></div>
                        <div class="diagram-vertical-arrow">&#10140;</div> <!-- Down arrow -->
                        <div class="diagram-connector"></div>

                        <!-- Diagram Row for MolectraVac machine and Q39/Q40 Uses -->
                        <div class="diagram-row">
                            <div class="diagram-box process-box">
                                <p>The MolectraVac machine microwaves</p>
                                <p>rubber into hydrocarbon</p>
                            </div>
                            <div class="diagram-arrow">&#10140;</div> <!-- Right arrow -->
                            <div class="diagram-box uses-box">
                                <ul class="diagram-list">
                                    <li>i) Used for activated carbon</li>
                                    <li><span class="question-number">39</span> <input type="text" class="completion-input" name="q39"> treatment</li>
                                    <li>Air filtration</li>
                                    <li>ii) Used for carbon black</li>
                                    <li>batteries</li>
                                    <li><span class="question-number">40</span> <input type="text" class="completion-input" name="q40"></li>
                                    <li>iii) Oil used for electricity</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="submit-section">
                <button type="button" id="submit-btn">Submit Answers</button>
            </div>
        </form>

        <div class="results-container" id="results-container">
            <h2 class="results-title">Your Answers</h2>
            <div id="score-display"></div>
            <div class="results-columns">
                <div class="results-column">
                    <h3>Questions 1-20</h3>
                    <div id="results-1-20"></div>
                </div>
                <div class="results-column">
                    <h3>Questions 21-40</h3>
                    <div id="results-21-40"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="highlight-popup">Highlight</div>
    <div id="progress-bar"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('listening-test');
            
            // --- Audio Playback ---
            const startBtn = document.getElementById('start-btn');
            const audioPlayerDiv = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            
            const audioFiles = [
                'test2_p1.mp3',
                'test2_p2.mp3',
                'test2_p3.mp3',
                'test2_p4.mp3'
            ];
            let currentAudioIndex = 0;

            function playNextAudio() {
                if (currentAudioIndex < audioFiles.length) {
                    audioSource.src = audioFiles[currentAudioIndex];
                    audioSource.play();
                    currentAudioIndex++;
                } else {
                    // All audio files have been played
                    startBtn.textContent = 'Test Completed';
                    startBtn.disabled = true;
                }
            }

            startBtn.addEventListener('click', function() {
                audioPlayerDiv.style.display = 'block';
                startBtn.textContent = 'Playing...';
                startBtn.disabled = true;
                playNextAudio(); // Start playing the first audio
            });

            audioSource.addEventListener('ended', function() {
                playNextAudio(); // Play the next audio when the current one ends
            });

            // --- Multiple Choice Selection & "Choose TWO" Logic ---
            form.querySelectorAll('.options .option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionGroup = this.closest('.question-group');
                    const isMultiSelectTwo = questionGroup.classList.contains('multi-select-two-group');

                    if (isMultiSelectTwo) {
                        const selectedOptionsInGroup = Array.from(questionGroup.querySelectorAll('.option.selected'));
                        const clickedOptionValue = this.dataset.value;
                        const hiddenInput = questionGroup.querySelector('input[type="hidden"]');
                        let currentSelections = hiddenInput.value ? hiddenInput.value.split(',') : [];

                        if (this.classList.contains('selected')) {
                            // Deselect if already selected
                            this.classList.remove('selected');
                            currentSelections = currentSelections.filter(val => val !== clickedOptionValue);
                        } else {
                            // Select if not selected
                            if (currentSelections.length < 2) {
                                this.classList.add('selected');
                                currentSelections.push(clickedOptionValue);
                            } else {
                                // If already two selected, deselect the first one and select the new one
                                const firstSelectedValue = currentSelections.shift(); // Remove the first
                                const firstSelectedOption = questionGroup.querySelector(`.option[data-value="${firstSelectedValue}"]`);
                                if (firstSelectedOption) {
                                    firstSelectedOption.classList.remove('selected');
                                }
                                this.classList.add('selected');
                                currentSelections.push(clickedOptionValue);
                            }
                        }
                        hiddenInput.value = currentSelections.join(',');
                    } else {
                        // Standard single-choice logic
                        const siblings = this.parentElement.querySelectorAll('.option');
                        siblings.forEach(sib => sib.classList.remove('selected'));
                        this.classList.add('selected');
                        const questionInput = this.closest('.question').querySelector('input[type="hidden"]');
                        questionInput.value = this.dataset.value;
                    }
                    updateProgressBar();
                });
            });

            // --- Night Mode Toggle ---
            const nightModeToggle = document.getElementById('night-mode-toggle');
            const body = document.body;
            const isNightMode = localStorage.getItem('nightMode') === 'enabled';
            if (isNightMode) { body.classList.add('night-mode'); }
            nightModeToggle.addEventListener('click', () => {
                body.classList.toggle('night-mode');
                localStorage.setItem('nightMode', body.classList.contains('night-mode') ? 'enabled' : 'disabled');
            });

            // --- Drag and Drop Logic ---
            function setupDragDrop(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                let draggedItem = null;

                container.addEventListener('dragstart', e => {
                    if (e.target.classList.contains('draggable-option') || e.target.classList.contains('matched-option')) {
                        draggedItem = e.target;
                        setTimeout(() => e.target.style.display = 'none', 0);
                        e.dataTransfer.setData('text/plain', e.target.dataset.optionId);
                    }
                });

                container.addEventListener('dragend', () => {
                    if (draggedItem) {
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                    }
                });
                
                container.addEventListener('dragover', e => e.preventDefault());

                container.querySelectorAll('.question-drop-target, .options-list-wrapper').forEach(zone => {
                    zone.addEventListener('dragenter', e => {
                        e.preventDefault();
                        if (zone.classList.contains('question-drop-target') || zone.classList.contains('options-list-wrapper')) {
                           zone.classList.add('drag-over');
                        }
                    });
                    zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        if (!draggedItem) return;

                        const optionId = draggedItem.dataset.optionId;
                        const originalOption = container.querySelector(`.draggable-option[data-option-id="${optionId}"]`);
                        const sourceQuestionId = draggedItem.parentElement.dataset.questionId;

                        // If dropping back into the options list
                        if (zone.classList.contains('options-list-wrapper')) {
                            if (originalOption) originalOption.classList.remove('hidden');
                            if(draggedItem.classList.contains('matched-option')) {
                                document.getElementById(`${sourceQuestionId}_hidden`).value = '';
                                draggedItem.remove();
                            }
                        } 
                        // If dropping into a question target
                        else if (zone.classList.contains('question-drop-target')) {
                            // If target has an item, return it
                            if (zone.children.length > 0) {
                                const oldOptionId = zone.children[0].dataset.optionId;
                                const oldOriginalOption = container.querySelector(`.draggable-option[data-option-id="${oldOptionId}"]`);
                                if (oldOriginalOption) oldOriginalOption.classList.remove('hidden');
                            }
                            
                            // Add new item
                            if (originalOption) originalOption.classList.add('hidden');
                             if(draggedItem.classList.contains('matched-option')) {
                                document.getElementById(`${sourceQuestionId}_hidden`).value = '';
                            }
                            
                            const newMatchedOption = document.createElement('div');
                            newMatchedOption.className = 'matched-option';
                            newMatchedOption.draggable = true;
                            newMatchedOption.dataset.optionId = optionId;
                            newMatchedOption.textContent = optionId;
                            zone.innerHTML = '';
                            zone.appendChild(newMatchedOption);
                            document.getElementById(`${zone.dataset.questionId}_hidden`).value = optionId;
                        }
                        
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                        updateProgressBar();
                    });
                });
            }

            setupDragDrop('drag-match-25-30'); // Only one drag-match section in this test

            // --- Highlight Feature ---
            const highlightPopup = document.getElementById('highlight-popup');
            let currentSelection = null;

            document.addEventListener('mouseup', function(e) {
                if (e.target.id === 'highlight-popup' || e.target.closest('input, .audio-controls, #progress-bar')) {
                    return;
                }
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0) {
                    currentSelection = selection.getRangeAt(0);
                    const rect = currentSelection.getBoundingClientRect();
                    highlightPopup.style.display = 'block';
                    highlightPopup.style.left = `${rect.left + window.scrollX}px`;
                    highlightPopup.style.top = `${rect.top + window.scrollY - 35}px`;
                } else {
                    highlightPopup.style.display = 'none';
                }
            });
            
            document.addEventListener('mousedown', function(e) {
                 if (e.target.id !== 'highlight-popup' && highlightPopup.style.display === 'block') {
                    highlightPopup.style.display = 'none';
                 }
            });

            highlightPopup.addEventListener('click', function() {
                if (currentSelection) {
                    const span = document.createElement('span');
                    span.className = 'highlighted-text';
                    try {
                        span.appendChild(currentSelection.extractContents());
                        currentSelection.insertNode(span);
                    } catch (ex) {
                        console.warn("Could not highlight selection:", ex);
                    }
                }
                highlightPopup.style.display = 'none';
                window.getSelection().removeAllRanges();
            });

            // --- Progress Bar ---
            const progressBar = document.getElementById('progress-bar');
            for (let i = 1; i <= 40; i++) {
                const numDiv = document.createElement('div');
                numDiv.className = 'progress-number';
                numDiv.id = `progress-${i}`;
                numDiv.textContent = i;
                progressBar.appendChild(numDiv);
            }

            function updateProgressBar() {
                for (let i = 1; i <= 40; i++) {
                    const input = form.querySelector(`[name="q${i}"]`);
                    const progressNum = document.getElementById(`progress-${i}`);
                    if (input && input.value.trim() !== '') {
                        progressNum.classList.add('answered');
                    } else {
                        progressNum.classList.remove('answered');
                    }
                }
                // Also check multi-select groups
                const q17_18_selected = form.querySelector('[name="q17_18_selected"]');
                if (q17_18_selected && q17_18_selected.value.split(',').filter(Boolean).length > 0) {
                    document.getElementById('progress-17').classList.add('answered');
                    document.getElementById('progress-18').classList.add('answered');
                } else {
                    document.getElementById('progress-17').classList.remove('answered');
                    document.getElementById('progress-18').classList.remove('answered');
                }

                const q19_20_selected = form.querySelector('[name="q19_20_selected"]');
                if (q19_20_selected && q19_20_selected.value.split(',').filter(Boolean).length > 0) {
                    document.getElementById('progress-19').classList.add('answered');
                    document.getElementById('progress-20').classList.add('answered');
                } else {
                    document.getElementById('progress-19').classList.remove('answered');
                    document.getElementById('progress-20').classList.remove('answered');
                }
            }
            form.addEventListener('input', updateProgressBar);
            form.addEventListener('click', (e) => {
                if(e.target.classList.contains('option')) {
                    setTimeout(updateProgressBar, 50);
                }
            });
            updateProgressBar();

            // --- Correct Answers & Submission ---
            const correctAnswers = {
                q1: "sea",
                q2: "animals",
                q3: "eggs",
                q4: "fire",
                q5: ["15.75", "fifteen point seven five"], // Handles number or word form
                q6: "fishing",
                q7: "bike",
                q8: "football",
                q9: "july",
                q10: "pool",
                q11: "b",
                q12: "a",
                q13: "c",
                q14: "b",
                q15: "c",
                q16: "a",
                q17_18_selected: ['c', 'd'], // For the "Choose TWO" group Q17-18
                q19_20_selected: ['a', 'c'], // For the "Choose TWO" group Q19-20
                q21: "b",
                q22: "a",
                q23: "b",
                q24: "c",
                q25: "c",
                q26: "b",
                q27: "a",
                q28: "f",
                q29: "h",
                q30: "g",
                q31: "month",
                q32: "profit",
                q33: "size",
                q34: "research",
                q35: "wires",
                q36: "dirt",
                q37: "plastic",
                q38: "floor",
                q39: "water",
                q40: "ink"
            };

            document.getElementById('submit-btn').addEventListener('click', function() {
                const userAnswers = {};
                let correctCount = 0;

                // Collect answers for standard inputs and drag-drop
                for (let i = 1; i <= 40; i++) {
                    const qName = `q${i}`;
                    const input = form.querySelector(`[name="${qName}"]`);
                    if (input) {
                        userAnswers[qName] = input.value.trim().toLowerCase();
                    }
                }

                // Collect answers for multi-select-two groups
                const q17_18_input = form.querySelector('[name="q17_18_selected"]');
                if (q17_18_input) {
                    userAnswers['q17_18_selected'] = q17_18_input.value.trim().toLowerCase();
                }
                const q19_20_input = form.querySelector('[name="q19_20_selected"]');
                if (q19_20_input) {
                    userAnswers['q19_20_selected'] = q19_20_input.value.trim().toLowerCase();
                }


                for (const qName in correctAnswers) {
                    if (!userAnswers.hasOwnProperty(qName)) continue;

                    const correctAnswer = correctAnswers[qName];
                    const userAnswer = userAnswers[qName];

                    if (qName === 'q17_18_selected' || qName === 'q19_20_selected') {
                        // Logic for "Choose TWO" questions
                        const userSelectedArray = userAnswer.split(',').filter(Boolean); // Filter out empty strings
                        const correctSet = correctAnswer; // Already lowercase in correctAnswers object

                        let matches = 0;
                        userSelectedArray.forEach(userVal => {
                            if (correctSet.includes(userVal)) {
                                matches++;
                            }
                        });
                        correctCount += matches; // Add 0, 1, or 2 points
                    } else if (Array.isArray(correctAnswer)) {
                        // Logic for answers that can be in multiple forms (e.g., Q5)
                        if (correctAnswer.includes(userAnswer)) {
                            correctCount++;
                        }
                    } else {
                        // Logic for single-word/single-letter answers
                        if (userAnswer === correctAnswer) {
                            correctCount++;
                        }
                    }
                }
                
                let results1to20 = '';
                let results21to40 = '';

                for (let i = 1; i <= 40; i++) {
                    const qName = `q${i}`;
                    let userAns = userAnswers[qName] || 'No answer';
                    let correctAns = '';

                    // Special handling for "Choose TWO" questions for display
                    if (i === 17 || i === 18) {
                        userAns = userAnswers['q17_18_selected'] || 'No answer';
                        correctAns = correctAnswers['q17_18_selected'].join(' / ').toUpperCase();
                    } else if (i === 19 || i === 20) {
                        userAns = userAnswers['q19_20_selected'] || 'No answer';
                        correctAns = correctAnswers['q19_20_selected'].join(' / ').toUpperCase();
                    } else {
                        correctAns = Array.isArray(correctAnswers[qName]) ? correctAnswers[qName].join(' / ') : correctAnswers[qName];
                    }
                    
                    const resultItem = `<div class="result-item">
                        <span class="result-question">${i}.</span> User: ${userAns} | Correct: ${correctAns.toUpperCase()}
                    </div>`;
                    if (i <= 20) {
                        results1to20 += resultItem;
                    } else {
                        results21to40 += resultItem;
                    }
                }

                document.getElementById('results-1-20').innerHTML = results1to20;
                document.getElementById('results-21-40').innerHTML = results21to40;
                document.getElementById('score-display').textContent = `You got ${correctCount} out of 40 correct!`;
                document.getElementById('results-container').style.display = 'block';
                document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
