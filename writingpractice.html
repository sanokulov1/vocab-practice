<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IELTS Writing Practice</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --accent: #4cc9f0;
      --success: #4ade80;
      --warning: #f59e0b;
      --danger: #ef4444;
      --light: #f8f9fa;
      --dark: #1e293b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
      min-height: 100vh;
      color: var(--dark);
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      border: 1px solid rgba(224, 242, 254, 0.8);
    }

    .card:hover {
      box-shadow: 0 15px 40px rgba(67, 97, 238, 0.1);
    }

    .header-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(67, 97, 238, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
      color: white;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 4px 6px rgba(74, 222, 128, 0.2);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(74, 222, 128, 0.3);
    }

    input, select, textarea {
      border: 1px solid #d1d5db !important;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary) !important;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15) !important;
    }

    .timer-pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    .task-card {
      border-left: 4px solid var(--primary);
    }

    .progress-bar {
      height: 6px;
      border-radius: 3px;
      background: #e2e8f0;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--primary) 100%);
      transition: width 1s linear;
    }

    .word-count-badge {
      background: var(--accent);
      color: white;
      border-radius: 9999px;
      padding: 2px 10px;
      font-size: 0.8rem;
      display: inline-block;
    }

    .sticky-header {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      /* Reduced padding for compactness */
      padding: 0.25rem 0.5rem; /* py-1 px-2 */
    }
    /* Standard font for timer text */
    .timer-text {
      font-size: 1rem; /* Standard font size */
      line-height: 1.5rem; /* Standard line height for text-base */
    }


    .custom-shadow {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.03), 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .text-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .writing-area {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .writing-area:focus {
      background: white;
      box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
    }

    /* Custom styles for Task 1 layout */
    .task1-layout-container {
      display: flex;
      flex-direction: column; /* Default to column for small screens */
      gap: 1.5rem; /* Gap between sections */
      /* Calculate height for main content area to enable scrolling within children */
      max-height: calc(100vh - 160px); /* Adjusted value based on header + title + margin */
    }

    @media (min-width: 1024px) {
      .task1-layout-container {
        flex-direction: row; /* Row for large screens */
        height: 100%; /* Fill the constrained height of the parent */
      }
      .task1-image-panel, .task1-writing-section {
        flex: 1; /* Distribute space equally */
        height: 100%; /* Make them fill the height of the parent */
        display: flex; /* Ensure inner content can flex */
        flex-direction: column; /* Stack header/content inside */
      }
      .task1-image-panel .image-content-area,
      .task1-writing-section > div:last-child { /* Target the content area within writing section */
        flex-grow: 1;
        overflow-y: auto; /* Make content scrollable */
      }
    }

    /* Adjustments for image container within Task 1 */
    #task1ImageContainer img {
      width: 100%; /* Make image fill container */
      height: auto; /* Maintain aspect ratio */
      max-width: 100%; /* Ensure it doesn't overflow */
      object-fit: contain; /* Ensure the image is fully visible */
    }

    /* Sticky question for Task 2 */
    .sticky-question {
      position: sticky;
      /* Adjusted top value to be more compact below the timer */
      top: 40px; /* Approximate height of sticky-header + some margin */
      z-index: 10; /* Ensure it stays above other content */
      background: white; /* Or match your card background */
      padding-bottom: 0.25rem; /* Reduced padding below the question */
      box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Optional shadow for visual separation */
      border-bottom: 1px solid #e2e8f0; /* Optional border */
    }
    .sticky-question .header-gradient {
      padding: 0.25rem 0.5rem; /* Even smaller padding for header in sticky question */
    }
    .sticky-question .header-gradient h3 {
      font-size: 1rem; /* text-base (smaller than text-lg) */
    }
    .sticky-question .p-4 { /* Changed from p-6 to p-4 for question content */
      padding: 0.5rem 1rem; /* Reduced padding for question content */
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center py-8 px-4">
  <div id="app-container" class="w-full max-w-4xl lg:max-w-6xl">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold mb-2 text-gradient">IELTS Writing Practice</h1>
      <p class="text-gray-600">Improve your writing skills with timed practice sessions</p>
    </div>

    <!-- User Information Section -->
    <div id="userInfoSection" class="card space-y-6 p-8 mb-8">
      <div class="text-center">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-user-edit text-2xl text-blue-600"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-800">Get Started</h2>
        <p class="text-gray-600 mt-2">Please enter your name and email to start practicing</p>
      </div>

      <div class="space-y-4">
        <div>
          <label for="studentName" class="block text-gray-700 font-medium mb-2">Your Name</label>
          <div class="relative">
            <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input type="text" id="studentName" placeholder="John Smith" class="w-full pl-10 p-3 border rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500" required />
          </div>
        </div>

        <div>
          <label for="studentEmail" class="block text-gray-700 font-medium mb-2">Your Email</label>
          <div class="relative">
            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input type="email" id="studentEmail" placeholder="john@example.com" class="w-full pl-10 p-3 border rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500" required />
          </div>
        </div>
      </div>

      <button id="startPracticeBtn" class="btn-primary w-full py-3 rounded-lg text-lg font-medium mt-4">
        <i class="fas fa-pencil-alt mr-2"></i>Start Practice
      </button>

      <div class="flex items-center justify-center mt-4 text-sm text-gray-500">
        <i class="fas fa-shield-alt mr-2 text-blue-500"></i>
        <span>We respect your privacy. Your data is secure.</span>
      </div>
    </div>

    <!-- Task Selection and Practice Section (Initially hidden) -->
    <div id="practiceSection" class="hidden">
      <div id="taskSelectorContainer" class="card mb-6 p-6">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
            <i class="fas fa-tasks text-blue-600"></i>
          </div>
          <h2 class="text-xl font-bold text-gray-800">Select Task Type</h2>
        </div>

        <div class="mb-1 flex justify-between">
          <label for="taskSelector" class="block text-gray-700 font-medium">Choose your writing task:</label>
          <span class="text-sm text-gray-500">Select one to begin</span>
        </div>

        <select id="taskSelector" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white">
          <option value="">-- Select a Task --</option>
          <option value="1">Task 1 (20 minutes)</option>
          <option value="2">Task 2 (40 minutes)</option>
        </select>

        <div class="mt-4 grid grid-cols-2 gap-4">
          <div class="task-card p-4 rounded-lg bg-blue-50">
            <div class="flex items-center mb-2">
              <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center mr-2">
                <span class="text-blue-600 font-bold">1</span>
              </div>
              <h3 class="font-semibold">Task 1</h3>
            </div>
            <p class="text-sm text-gray-600">Summarize visual information</p>
            <div class="mt-2 flex items-center text-sm text-blue-600">
              <i class="fas fa-clock mr-1"></i>
              <span>20 minutes</span>
            </div>
          </div>

          <div class="task-card p-4 rounded-lg bg-indigo-50 border-l-4 border-indigo-500">
            <div class="flex items-center mb-2">
              <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center mr-2">
                <span class="text-indigo-600 font-bold">2</span>
              </div>
              <h3 class="font-semibold">Task 2</h3>
            </div>
            <p class="text-sm text-gray-600">Write an essay response</p>
            <div class="mt-2 flex items-center text-sm text-indigo-600">
              <i class="fas fa-clock mr-1"></i>
              <span>40 minutes</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sticky header for timer and labels -->
      <div class="sticky-header sticky top-0 rounded-lg custom-shadow z-20 mb-6">
        <div class="flex items-center justify-between">
          <div id="timer" class="font-bold flex items-center">
            <!-- Timer text only, no pulse circle -->
            <span>Time remaining: <span class="text-red-600 timer-text">--:--</span></span>
          </div>

          <div class="flex items-center">
            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded mr-2">
              <i class="fas fa-keyboard mr-1"></i> Writing
            </span>
            <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded">
              <i class="fas fa-graduation-cap mr-1"></i> IELTS
            </span>
          </div>
        </div>
        <!-- Progress bar removed -->
      </div>

      <!-- Task content display -->
      <div id="taskContent" class="card mb-6 p-0 overflow-hidden">
        <div class="header-gradient p-4">
          <h3 class="text-xl font-bold flex items-center">
            <i class="fas fa-question-circle mr-2"></i> Task Question
          </h3>
        </div>
        <div class="p-6">
          <p class="text-gray-600 text-center">Select a task to display the question</p>
        </div>
      </div>

      <!-- Main content area for Task 1 image and writing form -->
      <div id="mainContentArea" class="task1-layout-container">
        <!-- Left section for Task 1 image (hidden by default) -->
        <div id="task1ImagePanel" class="card hidden flex-1 flex-col task1-image-panel">
          <div class="header-gradient p-4">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-chart-bar mr-2"></i> TASK 1
            </h3>
            <p id="task1InstructionHeader" class="text-sm mt-2"></p> <!-- Moved instruction here -->
          </div>
          <div class="image-content-area flex-grow"> <!-- New div to control image area padding -->
            <img id="task1Image" alt="Task 1 image" class="max-w-full h-auto rounded-md shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x400/E0E0E0/333333?text=Image+Not+Found';" />
          </div>
        </div>

        <!-- Right section for writing form -->
        <div id="writingArea" class="card flex-grow task1-writing-section">
          <div class="header-gradient p-4">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-edit mr-2"></i> Your Response
            </h3>
          </div>
          <div class="p-4 flex flex-col flex-grow">
            <form id="writingForm" action="https://formspree.io/f/xkgzgokq" method="POST" class="space-y-4 flex flex-col flex-grow">
              <!-- Hidden inputs for form submission -->
              <input type="hidden" name="question" id="hiddenQuestion" />
              <input type="hidden" name="studentNameHidden" id="studentNameHidden" />
              <input type="hidden" name="studentEmailHidden" id="studentEmailHidden" />

              <!-- Textarea for writing with increased height and no vertical resize -->
              <div class="flex-grow flex flex-col">
                <label class="block text-gray-700 font-medium mb-2">
                  Write your answer below:
                  <span class="text-sm font-normal text-gray-500">(Minimum 150 words for Task 1, 250 words for Task 2)</span>
                </label>
                <textarea name="answer" id="answerTextArea" placeholder="Start writing your response here..." class="writing-area w-full p-4 rounded-lg flex-grow min-h-[300px]" spellcheck="false"></textarea>

                <div class="mt-4 flex justify-between items-center">
                  <div id="wordCount" class="text-gray-600">
                    <span class="word-count-badge">Word count: 0</span>
                  </div>

                  <div class="flex space-x-2">
                    <button type="button" class="px-4 py-2 text-sm border rounded-lg hover:bg-gray-50">
                      <i class="fas fa-save mr-1"></i> Save Draft
                    </button>
                    <button type="submit" id="submitBtn" class="btn-success px-6 py-2 rounded-lg font-medium">
                      <i class="fas fa-paper-plane mr-2"></i>Submit Answer
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="mt-6 text-center text-gray-500 text-sm">
        <!-- Removed "Practice makes perfect..." message -->
      </div>
    </div>
  </div>

  <script>
    // Data for Task 1 instructions and image names
    const task1Data = [
      {"instruction": "The diagram below shows how fabric is manufactured from bamboo. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask1.png"},
      {"instruction": "The bar chart shows the main reasons for migration to/from the UK in 2007. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask2.png"},
      {"instruction": "The bar charts show the percentage of households with different items in 2001 and 2008. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask3.png"},
      {"instruction": "The bar chart shows the number of people in 5 types of work in 2001 and 2008. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask4.png"},
      {"instruction": "The chart shows the number of Australian workforce in five industries between 1962 and 2012. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask5.png"},
      {"instruction": "The maps show the changes in a community center. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.", "image": "writingtask6.png"}
    ];

    // Updated Data for Task 2 questions
    const task2Questions = [
      "Countries should try to produce all the food for the population and import as little food as possible.\nTo what extent do you agree or disagree?",
      "Media coverage of violent crime frightens people and encourages criminals. Some people say it should be banned from newspapers and TV programs.\nTo what extend do you agree or disagree?",
      "Today, many people do not know their neighbors.\nWhy is this?\nWhat can be done about this?",
      "Fewer young people play sports these days.\nWhy is this?\nWhat can be done to encourage more young people to do sports?",
      "New technologies have changed the way children spend their free time.\nDo you think the advantages of this trend outweigh the disadvantages?",
      "It is important for people to take risks, in both their professional lives and personal lives.\nDo the advantages of taking these risks outweigh the disadvantages?",
      "Nowadays, there is more and more competition for getting into university.\nIs this a positive or negative development?",
      "Around the world, rural people are moving to cities and urban areas, so populations in the countryside are decreasing.\nIs this a positive or negative development?",
      "Some believe that research on family history is a useful thing to do, while others disagree.\nDiscuss both sides and give your own opinion.",
      "Some believe secondary students should learn international news as a subject at school, while others think it’s a waste of time.\nDiscuss both views and give your opinion."
    ];

    // Get references to DOM elements
    const userInfoSection = document.getElementById("userInfoSection");
    const practiceSection = document.getElementById("practiceSection");
    const startPracticeBtn = document.getElementById("startPracticeBtn");
    const studentNameInput = document.getElementById("studentName");
    const studentEmailInput = document.getElementById("studentEmail");
    const studentNameHidden = document.getElementById("studentNameHidden");
    const studentEmailHidden = document.getElementById("studentEmailHidden");

    const taskSelectorContainer = document.getElementById("taskSelectorContainer");
    const taskSelector = document.getElementById("taskSelector");
    const taskContent = document.getElementById("taskContent");
    const hiddenQuestion = document.getElementById("hiddenQuestion");
    const timerDisplay = document.getElementById("timer");
    const writingForm = document.getElementById("writingForm");
    const submitBtn = document.getElementById("submitBtn");
    const answerTextArea = document.getElementById("answerTextArea");
    const wordCountDisplay = document.getElementById("wordCount");

    const task1ImagePanel = document.getElementById("task1ImagePanel");
    const task1Image = document.getElementById("task1Image");
    const task1InstructionHeader = document.getElementById("task1InstructionHeader");
    const progressBar = document.getElementById("progress");
    const mainContentArea = document.getElementById("mainContentArea");
    const writingArea = document.getElementById("writingArea");


    let countdownInterval;
    let timeRemaining = 0;
    let totalTime = 0;
    let selectedTaskDuration = 0; // To store duration for starting timer after warning

    // Function to display a custom alert message
    function showCustomAlert(message, isSubmission = false) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-info-circle text-blue-600 text-xl"></i>
          </div>
          <p class="text-lg font-semibold mb-4">${message}</p>
          ${isSubmission ? '<button id="continuePracticeBtn" class="btn-primary py-2 px-6 rounded-lg">Continue Practice</button>' : '<button id="closeAlert" class="btn-primary py-2 px-6 rounded-lg">OK</button>'}
        </div>
      `;
      document.body.appendChild(modal);

      if (isSubmission) {
        document.getElementById('continuePracticeBtn').addEventListener('click', () => {
          document.body.removeChild(modal); // Remove modal before redirecting
          window.location.href = 'vocab-practice.html'; // Redirect to vocab-practice.html
        });
      } else {
        document.getElementById('closeAlert').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
      }
    }

    // Function to show copy/paste warning and then start test
    function showCopyPasteWarningAndStartTest(duration) {
        selectedTaskDuration = duration; // Store duration
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                </div>
                <p class="text-lg font-semibold mb-4">To prevent plagiarism, we have disabled copy/pasting in this field.</p>
                <p class="text-md text-gray-700 mb-6">In the real IELTS exam, you are allowed to copy and paste within your response field.</p>
                <button id="understoodBtn" class="btn-primary py-2 px-6 rounded-lg">I Understood</button>
            </div>
        `;
        document.body.appendChild(modal);

        document.getElementById('understoodBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
            startTimer(selectedTaskDuration); // Start timer after user understands
        });
    }


    // Function to start the timer
    function startTimer(duration) {
      clearInterval(countdownInterval);
      timeRemaining = duration;
      totalTime = duration;
      updateTimerDisplay();

      countdownInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 0) {
          clearInterval(countdownInterval);
          showCustomAlert(`
            <p>Thank you for submitting your essay/report.</p>
            <p class="mt-2">Your work will be randomly selected for checking by Jurabek Sanokulov❤️❤️❤️</p>
            <p class="mt-2">Your feedback will be sent through your email and will be posted on our Telegram channel: <a href="https://t.me/ieltswithsanokulov" target="_blank" class="text-blue-600 hover:underline">IELTSwithSANOKULOV</a></p>
          `, true);
          writingForm.submit();
        }
      }, 1000);
    }

    // Function to update the timer display
    function updateTimerDisplay() {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      timerDisplay.innerHTML = `<span>Time remaining: <span class="text-red-600">${minutes}:${seconds < 10 ? '0' : ''}${seconds}</span></span>`;
    }

    // Function to update the word count
    function updateWordCount() {
      const text = answerTextArea.value.trim();
      const words = text === '' ? [] : text.split(/\s+/).filter(word => word.length > 0);
      wordCountDisplay.innerHTML = `<span class="word-count-badge">Word count: ${words.length}</span>`;
    }

    // Function to load the selected task
    function loadTask() {
      const selectedType = taskSelector.value;
      
      // Reset task content visibility and styling
      taskContent.classList.remove("hidden", "sticky-question");
      taskContent.style.top = ''; // Clear any inline top style
      taskContent.innerHTML = `<div class="header-gradient p-4">
          <h3 class="text-xl font-bold flex items-center">
            <i class="fas fa-question-circle mr-2"></i> Task Question
          </h3>
        </div>
        <div class="p-6">
          <p class="text-gray-600 text-center">Select a task to display the question</p>
        </div>`;

      task1ImagePanel.classList.add("hidden"); // Hide image panel by default
      task1Image.src = ""; // Clear image src
      task1InstructionHeader.textContent = ""; // Clear instruction from header

      clearInterval(countdownInterval);
      updateWordCount();

      if (selectedType === "1") {
        const i = Math.floor(Math.random() * task1Data.length);
        const task = task1Data[i];

        // Display instruction in the task1ImagePanel header
        task1InstructionHeader.textContent = task.instruction;
        hiddenQuestion.value = task.instruction;

        // Set image source for the dedicated image panel
        task1Image.src = task.image;
        task1ImagePanel.classList.remove("hidden"); // Show the image panel

        // Hide the general taskContent as instruction is now in image panel
        taskContent.classList.add("hidden");

        // Adjust main content area for Task 1 layout
        mainContentArea.classList.add("task1-layout-container");
        mainContentArea.classList.remove("flex-col", "lg:flex-row"); // Ensure correct flex direction
        writingArea.classList.add("flex-grow");
        task1ImagePanel.classList.add("flex-grow"); // Ensure image area expands

        showCopyPasteWarningAndStartTest(20 * 60); // Show warning then start timer
      } else if (selectedType === "2") {
        const q = task2Questions[Math.floor(Math.random() * task2Questions.length)];
        // Display question in content area
        taskContent.innerHTML = `<div class="header-gradient p-2"> <!-- Reduced padding -->
            <h3 class="text-base font-bold flex items-center"> <!-- Reduced font size to base -->
              <i class="fas fa-question-circle mr-2"></i> Task 2 Question
            </h3>
          </div>
          <div class="p-4"> <!-- Reduced padding -->
            <div class="bg-indigo-50 p-4 rounded-lg">
              <p class="text-gray-700 whitespace-pre-line">${q}</p>
            </div>
          </div>`;
        hiddenQuestion.value = q;

        // Add sticky class to taskContent for Task 2
        taskContent.classList.add("sticky-question");
        // Dynamically calculate top based on sticky-header height
        const stickyHeaderHeight = document.querySelector('.sticky-header').offsetHeight;
        taskContent.style.top = `${stickyHeaderHeight + 8}px`; // 8px for a small gap
        taskContent.classList.remove("hidden"); // Ensure it's visible for Task 2

        // Reset main content area for default flex layout for Task 2
        mainContentArea.classList.remove("task1-layout-container");
        mainContentArea.classList.add("flex-col", "lg:flex-row");
        writingArea.classList.remove("flex-grow");
        task1ImagePanel.classList.remove("flex-grow"); // Ensure image panel doesn't interfere
        task1ImagePanel.classList.add("hidden"); // Ensure image panel is hidden for Task 2

        showCopyPasteWarningAndStartTest(40 * 60); // Show warning then start timer
      } else {
        taskContent.innerHTML = `<div class="header-gradient p-4">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-question-circle mr-2"></i> Task Question
            </h3>
          </div>
          <div class="p-6">
            <p class="text-gray-600 text-center">Select a task to display the question</p>
          </div>`;
        timerDisplay.innerHTML = `<span>Time remaining: <span class="text-gray-600 timer-text">--:--</span></span>`; // Simplified initial timer
        taskContent.classList.remove("hidden"); // Ensure it's visible when no task is selected

        // Reset main content area for default flex layout if no task is selected
        mainContentArea.classList.remove("task1-layout-container");
        mainContentArea.classList.add("flex-col", "lg:flex-row");
        writingArea.classList.remove("flex-grow");
        task1ImagePanel.classList.remove("flex-grow");
        task1ImagePanel.classList.add("hidden"); // Ensure image panel is hidden
      }

      if (selectedType !== "") {
          taskSelectorContainer.classList.add("hidden");
      } else {
          taskSelectorContainer.classList.remove("hidden");
      }
    }

    // Event listener for starting the practice
    startPracticeBtn.addEventListener("click", () => {
      const name = studentNameInput.value.trim();
      const email = studentEmailInput.value.trim();

      if (name && email) {
        if (!validateEmail(email)) {
          showCustomAlert("Please enter a valid email address.");
          return;
        }

        studentNameHidden.value = name;
        studentEmailHidden.value = email;
        userInfoSection.classList.add("hidden");
        practiceSection.classList.remove("hidden");

        // Add slight animation
        practiceSection.style.opacity = 0;
        practiceSection.style.transform = "translateY(20px)";
        practiceSection.style.transition = "all 0.5s ease";

        setTimeout(() => {
          practiceSection.style.opacity = 1;
          practiceSection.style.transform = "translateY(0)";
        }, 10);
      } else {
        showCustomAlert("Please enter both your name and email address to start.");
      }
    });

    // Simple email validation
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Event listener for task selection change
    taskSelector.addEventListener("change", loadTask);

    // Event listener for textarea input to update word count
    answerTextArea.addEventListener("input", updateWordCount);

    // Prevent pasting into the textarea
    answerTextArea.addEventListener("paste", (event) => {
      event.preventDefault();
      showCustomAlert("Pasting is not allowed. Please type your answer.");
    });

    // Initial state
    timerDisplay.innerHTML = `<span>Time remaining: <span class="text-gray-600 timer-text">--:--</span></span>`; // Simplified initial timer
    updateWordCount();

    // Prevent form submission if no task is selected or timer is not started
    writingForm.addEventListener("submit", async (event) => {
      let preventFormSubmit = false;

      if (!taskSelector.value || timeRemaining <= 0) {
        showCustomAlert("Please select a task and ensure the timer has started before submitting.");
        preventFormSubmit = true;
      }

      // Check word count
      const text = answerTextArea.value.trim();
      const words = text === '' ? [] : text.split(/\s+/).filter(word => word.length > 0);

      if (words.length < 60) {
        showCustomAlert("Your response is too short. Please write at least 60 words to submit.");
        preventFormSubmit = true;
      } else if (taskSelector.value === "1" && words.length < 150) {
        showCustomAlert("Task 1 requires at least 150 words. You currently have " + words.length + " words.");
      } else if (taskSelector.value === "2" && words.length < 250) {
        showCustomAlert("Task 2 requires at least 250 words. You currently have " + words.length + " words.");
      }
      
      if (preventFormSubmit) {
        event.preventDefault();
      } else {
        // Prevent default form submission to handle it asynchronously
        event.preventDefault(); 
        
        // Show the custom submission message immediately
        showCustomAlert(`
            <p>Thank you for submitting your essay/report.</p>
            <p class="mt-2">Your work will be randomly selected for checking by Jurabek Sanokulov❤️❤️❤️</p>
            <p class="mt-2">Your feedback will be sent through your email and will be posted on our Telegram channel: <a href="https://t.me/ieltswithsanokulov" target="_blank" class="text-blue-600 hover:underline">IELTSwithSANOKULOV</a></p>
          `, true);

        // Submit the form data in the background using fetch
        const formData = new FormData(writingForm);
        try {
          const response = await fetch(writingForm.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json' // Request JSON response from Formspree
            }
          });
          if (response.ok) {
            console.log("Form submitted successfully in the background!");
          } else {
            console.error("Form submission failed:", response.statusText);
          }
        } catch (error) {
          console.error("Error submitting form:", error);
        }
      }
    });

  </script>

</body>
</html>
